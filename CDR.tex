% !TeX program = lualatex

\documentclass[12pt]{article}
\usepackage{geometry}
\geometry{
	paper=a4paper, % Paper size
	top=2.5cm, % Top margin
	bottom=2.5cm, % Bottom margin
	left=2.5cm, % Left margin
	right=2.5cm, % Right margin
	headheight=0.75cm, % Header height
	footskip=1.5cm, % Space from the bottom margin to the baseline of the footer
	headsep=0.75cm, % Space from the top margin to the baseline of the header
	%showframe, % Uncomment to show how the type block is set on the page
}
\usepackage[english]{babel}
\usepackage[]{ragged2e}

\addto\captionsenglish{% Replace "english" with the language you use
  \renewcommand{\contentsname}%
    {Table of Contents}}

\usepackage{blindtext}
% \usepackage{background}
%-------------------------------- Character encoding ----------------------------
\usepackage[]{fontspec}
\usepackage[T1]{fontenc}
\setmainfont{Times New Roman}
%----------------------------- Mathematics packages from AMS ---------------

\usepackage{amsmath, amsfonts, amsthm, amssymb}
\usepackage{braket, nicefrac}

% ----------- International System of Units
\usepackage{siunitx}
\usepackage{tikz}

%------------------------------ Lists / numbers -------------------------
\usepackage{enumitem, multicol}

%------------------------------- Figure insertions --------------
\usepackage{graphicx, float}  % Use option [H] to force the placement of a figure
\usepackage{keystroke}
\usepackage{pgfplots}\usepgfplotslibrary{units}\pgfplotsset{compat=1.16}
\usepackage{fancyhdr}
\usepackage{eso-pic}
%------------------------------- Line Spacing --------------
\usepackage{setspace}

%------------------------------- Depth of the ToC --------------
\setcounter{tocdepth}{2}

%%%%%%%%%%%%%%%%%%%%%%%%%% Hyperlink References %%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[hidelinks]{hyperref}

%--------------------% Storage Path for images %-----------------%
\graphicspath{{graphics/}{Graphics/}{./}}

\setcounter{tocdepth}{4}
\setcounter{secnumdepth}{4}

% \backgroundsetup{
% 	scale = 1.0,
% 	opacity = 0.5,
% 	angle = 0,
% 	contents = {\includegraphics[width=\paperwidth]{teknofest_logo.png}}
% }
\pagestyle{fancy}
\fancyhf{}
\chead{FIGHTER UAV COMPETITION 2022}
\cfoot{ASTROTECH}
\rfoot{\thepage}

\pagenumbering{gobble} % Title page
\begin{document}
\setstretch{1.15}


\begin{titlepage}
    \centering
    \AddToShipoutPictureBG{
        \begin{tikzpicture}[opacity=0.3]\node at
        (0,0){\includegraphics[width = \paperwidth ]{teknofest_logo.png}};
        \end{tikzpicture}
        }

	\title{ %TODO texts can be made bigger
		TEKNOFEST \\
		AVIATION, SPACE AND TECHNOLOGY FESTIVAL \\
		FIGTHER UAV COMPETITION \\
		CRITICAL DESIGN REPORT \\}
	\author{
		TEAM NAME: ASTROTECH \\
		AUTHORS : xxxxx,\\} %TODO Authors to be added
	\date{}
	\maketitle
\end{titlepage}	


% \noBgThispage
\pagenumbering{arabic}
\stepcounter{page}
\tableofcontents % Table of contents
\clearpage


\section{BASE SYSTEM SUMMARY}
\subsection{System Description}
\justify 

The basic mission description of Astrotech UAV system is selecting a target by analyzing data from rival UAVs moving in the air, performing an appropriate approach to the target UAV to obtain a visual contact and pursuing the rival UAV with the help of the guidance algorithm. The Astrotech UAV is also capable of diving onto ground targets whose coordinates are given and collecting data on these targets.

\justify
The UAV system, the combination of the Astrotech UAV and the ground station, consists of components under two headings, those onboard and those in the ground station. The onboard components are located inside the fuselage and enable high maneuverability and robustness for fully autonomous flight, which are key properties to fulfill the mission requirements. Among these onboard components, the flight controller is responsible for the stable flight of the UAV using data obtained from its sensors, such as IMU and magnetometer. It also sets the standard for interconnection between the controlled elements and the mission software. In addition to sensors in the flight controller, extra external sensors, such as GPS, airspeed sensor and LIDAR are also connected to it. Another onboard component is the companion computer on which mission software runs. It directly or indirectly uses data from all other sensors, including the camera, and processing this data, it transmits the commands-control outputs to the flight controller. For communication of the Astrotech UAV with the ground station, in addition to the use of RFD868 telemetry set for mutual telemetry communication, R12DS receiver for receiving the inputs from the RF controller, Ubiquiti Bullet M5-HP for displaying the view of UAV are used.

\justify
The ground station in the UAV system also consists of numerous electronic components, one of which is the ground station computer. It is responsible for the communication with the main server, analysis of data obtained from the server and transmitting it to the Astrotech UAV. It further allows the data of the Astrotech UAV to be displayed in a visual format with a GUI. In addition, one of the telemetry transceivers, the RF controller required to manually control the UAV when necessary, and a Wi-Fi receiver, that is required to monitor the image from the ground station, are also located in the ground station. Finally, the RTK module, which is used to increase the sensitivity of the GPS data, is also located in the ground station.

\subsection{System Final Performance Specifications}
In this part, the final performance specifications of the system that are found from the analysis and simulation programs are given.

% \begin{table}
% 	\centering
% 	%TODO Table here
% \end{table}

\justify
As a result of our calculations, Astrotech UAV’s takeoff weight is found 3100 grams, and the useful load is found 1500 grams, so we need 3100 grams of lift force to maintain a steady level flight. As a result, we find the cruise speed as 17 meters per second to provide this much lift force at low angle of attack values (0-2), in other words, to fly at a steady level. Moreover, the speed on the stall position, where the angle of attack rises beyond a specific point, then lift begins to decrease, is found at 9.5 meters per second by the formula:

\begin{align}
	V_{stall} = \sqrt{ \frac{2W}{\rho \cdot S C_{L max}}} 
\end{align}

% TODO Figure here
\justify
The flight time has been calculated as 24.7 minutes, and CL/CD ratio has been calculated as 20 for cruise speed. For detailed information, see 3.3 from the report.
\justify
The average rate of climb value of Astrotech UAV has been evaluated as 8.8 m/s by the formula:

\begin{align}
	R_{OC} = \frac{T \cdot V_\infty - D \cdot V_\infty}{W}
\end{align}

The weight of the aircraft is 30.411 Newton, thrust (T) equals 18.3 Newton, drag (D) equals 2.5 Newton, and the aircraft's speed is equal to 17 meters per second, that is, cruise speed. If the values are put in the equation, the rate of climb can be found as 8.8 meters per second.
\justify
Camera resolution is an important specification which affects the image quality and therefore influences our ability to detect or characterize objects of interest during tacking and detecting competitor UAVs. The decided camera module supports up to 120 fps for full HD resolution which is critical in any application involving fast motion.
\justify
It is expected that the companion computer can work at 30 FPS when selected image processing methods are used. NVIDIA Xavier NX Developer Kit has NVIDIA Volta architecture with 384 NVIDIA CUDA® cores, and 48 Tensor cores and these features are enough to satisfy our expectations. 
\justify
The minimum turn radius is found as 9.2 meters. While finding the minimum turn radius, the banking angle plays a vital role in finding the load factor (n) because the load factor is equal to $\frac{1}{\cos(\Phi)}$ where \Phi is the banking angle. Moreover, if \Phi  approaches 2, the load factor value goes to infinity and, therefore, 1n becomes closer to 0. As a result, if we look at the minimum turn radius equation, which is $R_{min}=\frac{V^2_{stall}}{g \cdot \sqrt{1-\frac{1}{n^2}}}$ . Stall speed is 9.5 meters per second, g is the gravitational acceleration, which is equal to 9.81 meters per second square, and, if $\frac{1}{n}$ is equal to 0, the value inside the square root is the 1. As a result, the minimum radius turn value becomes 9.22 meters.


\section{ORGANIZATION SUMMARY}
\subsection{Team Organization}
%TODO Team Organization figure here
\justify As can be seen from the organization chart, the METU Comet Astrotech Team consists of the team captain, three  sub-teams and finance and logistics member.

\subsection{Timeline and Budget}
\paragraph*{Timeline} The lines shown in blue show the content of the planned timeline announced in March. The works performed and the period in which they were carried out are shown in green. Worked parts of unfinished jobs are marked in yellow and the rest in red. The parts marked in red thus show the current plan as well.

\paragraph*{Budget} Bütçe ile ilgili tabloda tedarik edilen ürünler işaretlenmiştir. Bu ürünler için ödenen tutar ve tahmini tutar birlikte verilmiştir. Tedarik edilemeyen ürünler için güncel fiyatlar tabloya eklenmiştir. 
should be turned to english.

\section{DETAILED DESING SUMMARY}
\subsection{Final System Architecture}
\justify
In this section, the final version of the system architecture, the brand / model information of the hardware to be used should be included. If there is a difference with the conceptual architecture, it should be stated and the reason should be explained.
%TODO System Architecture figure here
\justify

\subsection{Subsystems Summary}
In this chapter; compliance of selected subsystems with vehicle requirements and selection criteria specified in the preliminary design report will be explained. If there is more than one option researched for the same duty, it should also be explained why the final product was chosen. 

\paragraph*{Flight Controller and GPS Sensor} PX4 autopilot software is preferred to ensure the stability of the UAV during flight and to prepare the appropriate background for the autonomous mission software to be developed. Flight controllers compatible with this software were examined. Pixhawk Cube Orange is preferred because it has a lower error rate in IMU data than its competitors, is easily accessible, has detailed documentation and many sample projects. On the other hand, the reasons behind the selection of GPS sensor were RTK module compatibility, update rate, and low error rates. In this regard, it was decided that the Here+3 met our requirements, with 2.5 meters accuracy without using the RTK module. Also, when RTK module is used, the error value can be minimized up to 0.25 meters. 

\paragraph*{Companion Computer} To obtain real-time performance, an onboard computing unit responsible for object detection and tracking as well as the guidance and target selection steps will be utilized. These computations would require relatively high computing power, thus; we preferred Nvidia Jetson Xavier NX, whose performance fulfills the requirements for relatively low cost. 

\paragraph*{Battery} The electronics and the propulsion system of our aircraft will be powered by a Li-Po battery that has enough capacity for a flight time of 25 minutes. According to our calculations, a 4 cell Li-Po battery with a nominal voltage of 14.8V and a capacity of 10000mAh is enough for our aircraft when we also consider the safety margins. As we can see from the power consumption table below in part 3.3, which includes components with major power use, our battery with a capacity of approximately 150W/h is adequate to power our aircraft for more than enough time.

\paragraph*{Propulsion System and Servos} For our UAV, we choose a motor-propeller pair that gives us the needed thrust to weight ratio of 1.1 as efficiently as possible.
% TODO FIGURE HERE 
\justify 
On the table above, we can see the thrust values and efficiency of different motors. We choose the T-Motor AT3520 850KV Motor because of it sufficient thrust value and high efficiency. This motor is powerful enough to supply our aircraft with enough thrust for the entirety of the competition. For the manipulation of the control surfaces, we will use servo motors with enough torque to guide our aircraft. ES09MD Servo Motors are selected to be used. They are small, lightweight and have enough torque. They were also preferred because they have metal gears and can be driven digitally. To drive our motors, we will use an ESC with a maximum current of 80A with a built-in BEC. Hobbywing Skywalker 80A ESC is selected to be used as it can provide the necessary power to our system.

\paragraph*{Camera} The features of the camera and its suitability for UAV  are mentioned. The selected camera is e-CAM24-CUNX, which is a Full HD MIPI CSI-2 global shutter camera. This camera is based on a 1/ 2.6” AR0234CS global shutter CMOS image sensor with a well-tuned ISP. Its global shutter capability along with 120fps frame rate helps to minimize frame to frame distortion and reduce the motion artifacts while capturing. Therefore, the UAV can obtain clear images of competitor UAVs while detecting and tracking. eCAM24-CUNX can be directly connected to the MIPI CSI-2 connector of the Nvidia Jetson platforms which are Jetson XavierTM NX/TX2 NX/Nano via Flex cable. Another advantage of the camera is that MISI CSI-2 is faster and has a reliable protocol to handle video from 1080p to 8k and has a higher net image bandwidth than USB. In addition, its DOFV is 133.9 and it meets the desired view for image processing algorithms.

\paragraph*{Pitot Tube} To calculate the airspeed of our aircraft, we will use a pitot tube that is compatible with the flight controller. Ready To Sky Jmt PT60 Pitot Tube is found to be adequate for our system.

\paragraph*{RC Controller} Radiolink AT10II and its transceiver RD12S have 12 channels for communication, 4km actual air range with 3ms transmission latency, which makes it suitable to use in Astrotech UAV. Also, another reason behind this selection is that it is more accessible to buy for the Metu Comet Astrotech team. 

\paragraph*{Telemetry Bundle} To transmit telemetry data between UAV and ground station with high speeds and low loss rates, a telemetry bundle with such specifications is needed. With a 40 km air transmission range, RFD868x Telemetry Bundle is suitable for the needs of Astrotech UAV. 

\subsection{Aircraft Performance Summary}
This section will demonstrate that the aircraft has propulsion that can remain in the air for the whole of a competition round.

Aerodynamic analysis of the Astrotech’s tail, wing, and body has been done using XFLR5, an aerodynamic analysis program (figure X.). As a result of the analysis, Lift coefficient vs. Drag Coefficient (CL/CD) vs. Alpha (α) is plotted, as shown in figure X1. %TODO Figure X1 here

The CL/CD vs. Alpha graph represents the efficiency of the aircraft, and the more CL/CD means, the more efficient the aircraft is. Therefore, we want High CL/CD for less fuel consumption and, as a result, more time in flight. Moreover, in steady level flight which is the condition thrust (T) is equal to drag force (D) and Lift Force (L) is equal to the weight of the aircraft(W), we want higher CL/CD values. In the graph, the CL/CD ratio between the 0-2 angle of attack (desired steady level flight angle of attacks) is between 19-21.  Thus, CL/CD ratio is around 20 when the condition is steady. However, Raymer (2018) stated that CL/CD ratio can decrease after the external components takes its place on the aircraft. Thus, after the external components such as servos are placed at the outer skeleton of the frame, we premeditate that this ratio can decrease up to 12. 


Moreover, in steady level flight, $T/D$ should be equal to $W/L \ \  (\frac{T}{D}=\frac{W}{L})$, and if we rearrange this equation, we can find the equation which plays a vital role in thrust calculations $\frac{T}{W}=\frac{D}{L}=\frac{C_D}{C_L}$. The weight of the aircraft is $30.411 Newton$ $(\frac{3100[g]9.81[m/s2]}{1000[g/kg]})$. The CL/CD ratio is 12 ($CD/CL$ ratio is $1/12$). If we put the values into the equation, we will find the required thrust for steady level flight as $2.53 Newton$ (260 grams). However, in a competition like the Fighting UAV, the competitor UAVs should be very aerobatic and maneuverable to accomplish the missions of the competition like dogfighting or kamikaze diving. During maneuvers, the engine has to generate more additional thrust. Therefore, 260 grams of thrust cannot be enough to succeed in the competition. Because of it, excess thrust should come into play through our thrust calculations. The average excess thrust has been calculated as $15.7 Newton$ (1600 grams). As a result, the required thrust force can be calculated as $18.3 Newton$ (1860 grams). Moreover, we can obtain 5m/s2 $(F_{net} (Excess Thrust) = m \times a )$ acceleration in x-direction with this excess thrust.       

\begin{align}
	Excess \ Thrust = Thrust \ Force \ - Drag \ Force
\end{align}

\paragraph*{Average Endurance} The endurance can be changed by how much thrust is applied by the engine. For example, suppose the engine provides thrust just for the steady level flight. In that case, the endurance will be very high because the consumed power from the battery will be low. However, if it is allowed for \% 100 throttle, the endurance will be lower than the calculated endurance for steady level flight because the consumed power will be high. Therefore, it is needed to find an average value for endurance. Moreover, the thrust value we should look for is 1860 grams, and the corresponding consumed power value which can be found in the motor manufacturer’s datasheet is given in table X. When all of the components are placed on the plane, they consume the power provided by the battery. Firstly, we find this consumed power, and after that, we should find the current by using the formula X1. Lastly, if we divide the ampere*hour of the battery by the current, we can reach the time that the frame can withstand in the air.

\begin{align}
	Power&= Voltage  \times Current \\
	 (P &= V \cdot I)\\
	\frac{10000 \ mAh}{1000 \ I } &= Time 
\end{align}
%ToDO Table X here
The consumed power of the components is found by using the formula X1. The total consumed power is seen as 360 Watts. Moreover, our battery’s voltage value is 14.8 Volts. If we put the voltage value of the battery with the total consumed power in the formula X1, we can find the average load current value of 24.32 Ampere. Furthermore, we know that the battery has 10000 mAh and the average load current is 24.32 Ampere. As a result, we can find the time using the formula X2. The average endurance is found as 0.411 hours, equal to 24.7 minutes. Considering that the Fighting UAV competition will last 15 minutes, it can be seen that the average endurance is 9.7 minutes, more than the required time. Thus, our project is suitable for competition requirements.  Moreover, the test procedure cannot be done yet due to delayed financial support from Teknofest.
%Todo Figure here

\subsection{3D Design of Aircraft}

Astrotech UAV is the Eagle Talon model aircraft produced by X-UAV company and the 3D design of this model aircraft is not available on the Internet, so it has been designed using the CATIA and ANSYS Spaceclaim. In addition, the assembly process and technical drawing of the components has been done with the ANSYS Spaceclaim. While performing the structural integration of the Astrotech UAV, these integrations are made with considering the dimensions and weights of the avionics used, their distance from the center of gravity of the UAV and minimum cabling. Some components which need to be taken out or taken in often, such as batteries, or have too much cable connections must be placed easily accessible positions where are chosen close to the upper cover part. Power and data lines of electronics telemetry of high current power cables, for example, in such a way that they affect each other the least. It should also be considered that it is placed in places far from each other so that it does not affect the signal. has been kept. The technical drawing and CAD drawing of the Astrotech UAV is shown in Figure  and Figure , the dimensions in mm are shown in Figure , and the positioning of the avionics placed in it are shown in Figures  and . Wiring is not included in this positioning.


The location of components is given in the Figure . The points taken into consideration while making this distribution are the center of gravity and the comfort it offers to the user. There is enough space in the front part of Astrotech UAV for the battery. In this way, adjustments can be made to keep the center of gravity at the desired point.


%Todo Figure here

The top view of Astrotech UAV is given below. In the following figure the location of pitot tube and servos where is placed in wing and tail is given below. In the following figure the one part of symmetry can be seen. Also, there are servos in the other side of Astrotech UAV.



\subsection{Aircraft Weight Distrubution}

The location of the center of gravity is one of the most important factors affecting the flight characteristics of the UAV. In addition to a stable flight of our aircraft, high maneuverability is required for the missions. According to the information provided by company which produce this frame, when only the frame is considered, the center of gravity is 75mm behind the leading edge of the wing. As a result of both the information provided by the company and the analyzes made, the center of gravity was adjusted according to this point. The layout of the components is planned to determine the center of gravity at this point. Detailed weight, moment and center of weight calculation are given in detail in the Table  below. The center of gravity can be seen in the following Figure .

%todo figure here

The calculation is given Table  below. The moment according to x and y axis is calculated. According to x-axis the moment is 0 (gr*mm). According to y-axis the moment is 0,8 (gr*mm) which is equal to 0,8*10-6 (kg*m). This result is negligible. 



\section{AUTONOMOUS MISSIONS}
\subsection{Autonomous Lockdown}
\subsection{Kamikaze Mission}

\section{GROUND STATION AND COMMUNICATION}
Under this topic, the details about in-vehicle communication, vehicle-ground station communication and ground station to main server communication are given.
\subsection{In-Vehicle Communication}
\paragraph*{Camera-Companion Computer Communication} Communication between e-CAM24\_CUNX and Nvidia Xavier NX is based on CSI-2 MIPI communication specification. FPC connector is used to establish the connection. This connector allows the camera output port to be connected to the Camera0 (or Camera1) port of Xavier NX.

\paragraph*{Companion Computer-Flight Control Card} The communication of Xavier NX and Pixhawk Cuber Orange takes place according to UART, which is an asynchronous serial communication protocol. The sent data packages are prepared according to the MAVLink data protocol, and Fast RTPS (Real Time Publish and Subscribe) is also used for fast access. For this to be possible, it requires the use of the PX4-Fast RTPS(DDS) Bridge. In order to establish the hardware connection, it is necessary to connect the one side of connector to the Telemetry0 or Telemetry1 port of Pixhawk Cube Orange and then the relevant lines of it to the RX, TX, 5V and, GND ports of Xavier NX.

\paragraph*{Flight Controller-GPS} Communication between Pixhawk Cube Orange and Here3 GPS takes place according to CAN protocol. Here3 GPS connector is connected to CAN port of Pixhawk Cube Orange.

\paragraph*{Flight Controller-Airspeed Sensor} The communication between these components takes place via I2C protocol. To establish the connection, the connector of the Holybro digital airspeed sensor is connected to the I2C port of the Pixhawk Cube Orange.

\paragraph*{Flight Controller-Control Receiver}Communication between R12DSM and Pixhawk Cube Orange takes place according to SBUS protocol. SBUS is a serial communication protocol used especially in hobby vehicles. In order to establish the connection, the connector of the R12DSM must be connected to the SBUS port located at the beginning of the servo line of the Pixhawk Cube Orange.

\paragraph*{Flight Controller-Telemetry Module} Communication between Pixhawk Cube Orange and RFD868 will take place according to UART communication protocol. The data packages sent have a form suitable for the MAVLink communication protocol. In order to establish the hardware connection, the connector of the RFD868 is plugged into the Telemetry0 or Telemetry1 port of the Pixhawk Cube Orange. 

\paragraph*{Flight Controller-ESC-Servo Motors} Control outputs from Pixhawk Cube Orange are transmitted to ESC and servo motors as PWM signals.

\subsection{UAV-Ground Control Station Communcation}

\paragraph*{RFD868 Modules} The frequency range of these modules is 865-870 MHz and they enable RC PPM Passthrough with telemetry at the same time. When connected to Pixhawk, data packages are transmitted to the ground station according to the MAVLink communication protocol. They have a default Air Data transfer rate of 64 kbit/s and support up to 750 kbit/s. The connection between the RFD868 module used in the ground station and the ground station computer will be made via the USB port. Incoming data is packaged according to the MAVLink data protocol. These data coming to the ground station are used to update the interface with the pymavlink library.

\paragraph*{Ubiquiti Bullet M5-HP 5Ghz - LiteBeam-5AC-GEN2 Communication} Communication between these two modules takes place at 5.8 GHz. Omni-directional data transmission is provided by using mushroom antenna on Bullet M5. The LiteBeam-5AC-GEN2 used in the ground station has an antenna having greater gain. The connection between the module and the ground station computer will be provided with an Ethernet cable. Thanks to this LAN connection, the video coming from the camera can be followed from the ground station.

\paragraph*{AT9S PRO-R12DSM} The connection between the controller and the receiver takes place on the 2.4 GHz band. R12DSM has 12 channels and this is enough for the requirements of the design. 

\paragraph*{RTK Module Connection} Here+ RTK module is connected to the ground station computer via USB port.

\subsection{Ground Control Station Main Server Communication}
Communication in HTTP protocol will be provided in order to be able to access data about rival UAVs coming to the main server and to transfer the requested information of Astrotech UAV to the main server. The standards of communication will be determined by the competition committee. Hardware connection will be established via ethernet cable.

\section{USER INTERFACE DESIGN}
In this section, design of the interface/s that will used on ground control station should be explained. Positions of information like speed, altitude, mode change, locking rectangle must be shown on interface.

Astrotech Ground Station consists of two seperate units in order to provide the necessary controls for the flight and to transmit the command for the missions:

\begin{itemize}
	\item Open Source Ground Control Software
	\item Astrotech UAV
\end{itemize}

It is considered suitable to run in Ubuntu operating system due to the ease of use of UNIX with ground control station software architecture and the used computer has Ubuntu operating system.


\section{AIRCRAFT INTEGRATION}
\subsection{Stuctural Integration}
\subsection{Mechanical Integration}
\subsection{Electronic Integration}

\section{TEST AND SIMULATION}
\subsection{Sub-System Tests}
\subsection{Flight Test and Flight Checklist}

\section{SAFETY}

\section{REFERENCES}

\singlespacing
\bibliographystyle{IEEEtran} 
\bibliography{CDR}
\end{document}